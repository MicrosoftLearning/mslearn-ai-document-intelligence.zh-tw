---
lab:
  title: 建立組合的文件智慧服務模型
  module: Module 6 - Document Intelligence
---

# 建立組合的文件智慧服務模型

在此練習中，您將會建立兩個自訂模型並加以定型，使其能分析不同的稅務表格。 然後，您將建立包括這兩個自訂模型的組成模型。 您將透過提交表格來測試模型，並檢查其是否能夠正確辨識文件類型和標記的欄位。

## 設定資源

我們將使用指令碼來建立 Azure AI 文件智慧服務資源、具有範例表格的儲存體帳戶，以及資源群組：

1. 啟動 Visual Studio Code。
1. 開啟選擇區 (SHIFT+CTRL+P) 並執行 **Git：複製 ** 命令，將 `https://github.com/MicrosoftLearning/mslearn-ai-document-intelligence` 存放庫複製到本機資料夾 (哪個資料夾無關緊要)。
1. 複製存放庫後，請在 Visual Studio Code 中開啟此資料夾。

    > **注意**：如果 Visual Studio Code 顯示快顯訊息，提示您信任您所開啟的程式碼，請按一下快顯項目中的 [是，我信任作者]**** 選項。
    
    > **注意**：如果系統提示您新增必要的資產來組建和偵錯，請選取 [現在不要]****。 如果還有其他來自 Visual Studio Code 的塊顯示窗，您可以安心地將其關閉。

1. 展開左側窗格中 [Labfiles]**** 資料夾，然後以滑鼠右鍵按一下 [03-composed-model]**** 目錄。 選取要在整合式終端中開啟的選項，然後執行下列指令碼:

    ```powershell
    az login --output none
    ```

    > **注意**：如果您收到「無作用中訂用帳戶」的錯誤，且已啟用 MFA，則可能需要先登入至 `https://portal.azure.com` 的 Azure 入口網站，然後重新執行 `az login`。

1. 出現提示時，登入您的 Azure 訂用帳戶。 然後返回 Visual Studio Code，並等候登入流程完成。
1. 在整合式終端中，執行下列命令以設定資源：

   ```powershell
   ./setup.ps1
   ```

   > **重要**：指令碼所建立的最後一個資源是您的「Azure AI 文件智慧服務」服務。 如果因為已擁有 F0 服務層級而導致該命令失敗，請在此實驗室中使用該資源，或者使用 Azure 入口網站中的 S0 服務層級建立一個資源。

## 建立 1040 Forms 自訂模型

若要建立組成模型，我們必須先建立兩個或更多的自訂模型。 建立第一個自訂模型：

1. 在新的瀏覽器索引標籤中，在 `https://documentintelligence.ai.azure.com/studio` 中開始 **Azure AI 文件智慧服務工作室**
1. 向下捲動，然後在 [自訂模型]**** 底下，選取 [自訂擷取模型]****。
1. 如果系統要求您登入帳戶，請使用您的 Azure 認證。
1. 如果系統詢問您要使用哪一項 Azure AI 文件智慧服務資源，請選取您在建立 Azure AI 文件智慧服務資源時所使用的訂用帳戶和資源名稱。
1. 在 [My Projects]**** \(我的專案\) 下，選取 [+ Create a project]**** \(+ 建立專案\)。
1. 在 [Project name]**** \(專案名稱\) 文字方塊中，輸入 **1040 Forms**，然後選取 [Continue]**** \(繼續\)。
1. 在 [Configure service resource]**** \(設定服務資源\) 頁面上，於 [Subscription]**** \(訂用帳戶\) 下拉式清單中，選取您的 Azure 訂用帳戶。
1. 在 [資源群組]**** 下拉式清單中，選取為您建立的 [DocumentIntelligenceResources&lt;xxxx&gt;]****。
1. 在 **文件智慧服務或認知服務資源** 下拉式清單中，選取 **文件智慧&lt;xxxx&gt;**。
1. 在 **API 版本** 下拉式清單中，確定已選取 **2024-07-31 (Preview)** ，然後選取 **繼續**。
1. 在 [連接定型資料來源]**** 頁面上，於 [訂用帳戶]**** 下拉式清單中，選取您的 Azure 訂用帳戶。
1. 在 [資源群組]**** 下拉式清單中，選取 [DocumentIntelligenceResources&lt;xxxx&gt;]****。
1. 在 [Storage account]**** \(儲存體帳戶\) 下拉式清單中，選取唯一列出的儲存體帳戶。 如果您的訂用帳戶中有多個儲存體帳戶，請選擇以 *docintelstorage* 開頭的帳戶
1. 在 [Blob container]**** \(Blob 容器\) 下拉式清單中，選取 [1040examples]****，然後選取 [Continue]**** \(繼續\)。
1. 在 [Review and create]**** \(檢閱並建立\) 頁面中，選取 [Create project]**** \(建立專案\)。
1. 在*立即開始標記*彈出的*執行配置*中選取 [立即執行]****，等待分析完成。

## 為 1040 Forms 自訂模型加上標籤

現在讓我們在範例表格中標記欄位：

1. 在 [標籤資料]**** 頁面中，選取頁面右上方的 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **FirstName**，然後按 *Enter*。
1. 選取左側清單中名為 **f1040_1.pdf** 的文件，選取 [John]****，然後選取 [FirstName]****。
1. 在頁面右上方，選取 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **LastName**，然後按 *Enter*。
1. 在文件中，選取 [Doe]****，然後選取 [LastName]****。
1. 在頁面右上方，選取 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **City**，然後按 *Enter*。
1. 在文件中，選取 [Los Angeles]****，然後選取 [City]****。
1. 在頁面右上方，選取 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **State**，然後按 *Enter*。
1. 在文件中，選取 [CA]****，然後選取 [State]****。
1. 使用您建立的標籤，針對左側清單中的其餘表格重複標記程序。 標記同樣的四個欄位：[FirstName]**、[LastName]**、[City]**，以及 [State]**。 請注意，其中一份文件沒有城市或狀態資料。

> **重要**針對此練習的目的，我們只使用五個範例表格，並只標記四個欄位。 在您的真實世界模型中，您使用的範本數量越多越好，以將預測的正確性和信賴度最大化。 您也應該為表格中的所有可用欄位加上標籤，而不只是四個欄位。

## 為 1040 Forms 自訂模型定型

在範例表格已加上標籤，我們現在可以對第一個自訂模型進行定型：

1. 在 Azure AI 文件智慧服務工作室中，在畫面控制項右上角選取 **定型**。
1. 在 [Train a new model]**** \(將新模型定型\) 對話方塊中，於 [Model ID]**** \(模型識別碼\) 文字方塊中，輸入 **1040FormsModel**。
1. 在 [Build mode]**** \(建置模式\) 下拉式清單中，選取 [Template]**** \(範本\)，然後選取 [Train]**** \(定型\)。 
1. 在 [Training in progress]**** \(進行中的定型\) 對話方塊中，選取 [Go to Models]**** \(移至模型\)。

## 建立 1099 Forms 自訂模型

現在，您必須建立第二個模型，以針對範例 1099 稅務表格加以定型：

1. 在 Azure AI 文件智慧服務工作室中，選取 [自訂擷取模型]****。
1. 在 [My Projects]**** \(我的專案\) 下，選取 [+ Create a project]**** \(+ 建立專案\)。
1. 在 [Project name]**** \(專案名稱\) 文字方塊中，輸入 **1099 Forms**，然後選取 [Continue]**** \(繼續\)。
1. 在 [Configure service resource]**** \(設定服務資源\) 頁面上，於 [Subscription]**** \(訂用帳戶\) 下拉式清單中，選取您的 Azure 訂用帳戶。
1. 在 [資源群組]**** 下拉式清單中，選取 [DocumentIntelligenceResources&lt;xxxx&gt;]****。
1. 在 **文件智慧服務或認知服務資源** 下拉式清單中，選取 **文件智慧&lt;xxxx&gt;**。
1. 在 **API 版本** 下拉式清單中，確定已選取 **2024-07-31 (Preview)** ，然後選取 **繼續**。
1. 在 [連接定型資料來源]**** 頁面上，於 [訂用帳戶]**** 下拉式清單中，選取您的 Azure 訂用帳戶。
1. 在 [資源群組]**** 下拉式清單中，選取 [DocumentIntelligenceResources&lt;xxxx&gt;]****。
1. 在 [Storage account]**** \(儲存體帳戶\) 下拉式清單中，選取唯一列出的儲存體帳戶。
1. 在 [Blob container]**** \(Blob 容器\) 下拉式清單中，選取 [1099examples]****，然後選取 [Continue]**** \(繼續\)。
1. 在 [Review and create]**** \(檢閱並建立\) 頁面中，選取 [Create project]**** \(建立專案\)。
1. 選取 **執行配置**  下拉式按鈕，然後選取 **未分析的文件**。
1. 等待分析完成。

## 為 1099 Forms 自訂模型加上標籤

現在，使用一些欄位為範例表單加上標籤：

1. 在 [標籤資料]**** 頁面中，選取頁面右上方的 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **FirstName**，然後按 *Enter*。
1. 選取名為 **f1099msc_payer.pd** 的文件，選取 [John]****，然後選取 [FirstName]****。
1. 在頁面右上方，選取 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **LastName**，然後按 *Enter*。
1. 在文件中，選取 [Doe]****，然後選取 [LastName]****。
1. 在頁面右上方，選取 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **City**，然後按 *Enter*。
1. 在文件中，選取 [New Haven]****，然後選取 [City]****。
1. 在頁面右上方，選取 [+ 新增欄位]****，然後選取 [欄位]****。
1. 輸入 **State**，然後按 *Enter*。
1. 在文件中，選取 [CT]****，然後選取 [State]****。
1. 針對左側清單中的其餘表格重複標記程序。 標記同樣的四個欄位：[FirstName]**、[LastName]**、[City]**，以及 [State]**。 請注意，其中兩份文件沒有任何要加上標籤的名稱資料。

## 為 1099 Forms 自訂模型定型

您現在可以將第二個自訂模型定型：

1. 在 Azure AI 文件智慧服務工作室中，在右上角選取 **定型**。
1. 在 [Train a new model]**** \(將新模型定型\) 對話方塊中，於 [Model ID]**** \(模型識別碼\) 文字方塊中，輸入 **1099FormsModel**。
1. 在 [Build mode]**** \(建置模式\) 下拉式清單中，選取 [Template]**** \(範本\)，然後選取 [Train]**** \(定型\)。
1. 在 [Training in progress]**** \(進行中的定型\) 對話方塊中，選取 [Go to Models]**** \(移至模型\)。
1. 定型程序可能需要數分鐘的時間。 偶爾重新整理瀏覽器，直到這兩個模型都顯示 [succeeded]**** \(成功\) 狀態為止。

## 使用模型

現在模型已完成，讓我們使用範例表格加以測試：

1. 在 Azure AI 文化智慧服務工作室中，選取 **模型** 頁面，選取  **1040FormsModel**。
1. 選取 [測試]。
1. 選取 [瀏覽檔案]****，然後瀏覽至您複製存放庫的位置。
1. 選取 [03-composed-model/trainingdata/TestDoc/f1040_7.pdf]****，然後選取 [開啟]****。
1. 選取 [Run analysis] (執行分析)****。 Azure AI 文件智慧服務會使用撰寫的模型來分析表單。
1. 您分析的文件是 1040 稅務表格的範例。 請檢查 [DocType]**** 屬性，以確認系統使用的自訂模型是否正確。 另請檢查模型所識別的 [FirstName]****、[LastName]****、[City]****，以及 [State]**** 值。

## 清除資源

在您了解組成模型的運作方式之後，讓我們移除您在 Azure 訂用帳戶中所建立的資源。

1. 在 `https://portal.azure.com/` 的 **Azure 入口網站**中，選取 [資源群組]****。
1. 在 [資源群組]**** 清單中，選取您所建立的 [DocumentIntelligenceResources&lt;xxxx&gt;]****，然後選取 [刪除資源群組]****。
1. 在 [輸入資源群組名稱]**** 文字方塊中，輸入資源群組的名稱，然後選取 [刪除]**** 以刪除文件文件智慧資源和儲存體帳戶。

## 深入了解

- [組成自訂模型](/azure/ai-services/document-intelligence/concept-composed-models)
